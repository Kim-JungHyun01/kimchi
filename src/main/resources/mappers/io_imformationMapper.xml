<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="kr.co.kim.mappers.io_imformationMapper"> <!--중요-->
  
  <!--java.util.Hashmap-->
  <resultMap type="java.util.HashMap" id="obtain">
 	<result column="obtain_no" property="number" />
 	<result column="user_id" property="id" />
 	<result column="obtain_quantity" property="quantity" />
 	<result column="obtain_deliveryDate" property="deliveryDate" />
 	<result column="obtain_status" property="status" />
 	<result column="ma_name" property="name" />
 	<result column="ma_price" property="price" />
 	<result column="ma_unit" property="unit" />
 	<result column="ma_specifications" property="specifications" />
  </resultMap>


<!--입고 추가-->
<insert id="io_add" parameterType="IOVO">
	INSERT INTO `kimchi`.`io`
(`io_id`,
`io_status`,
`io_quantity`,
`io_date`,
`io_information`,
`io_return_date`,
`invoice_issuance_status`,
`ma_id`,
`obtain_no`)
VALUES
(io_id=#{io_id},
io_status=#{io_status},
io_quantity=#{io_quantity},
io_date=now,
io_information=#{io_information},
io_return_date=#{io_return_date},
invoice_issuance_status=#{invoice_issuance_status},
ma_id=#{ma_id},
obtain_no=#{obtain_no})
	
</insert>





<!--조달중인 material 상세리스트 조회
-->
<resultMap type="materialVO" id="MaterialVO">
	<result column="ma_name" property="ma_name"/>
	<result column="ma_price" property="ma_price"/>
	<result column="ma_unit" property="ma_unit"/>
	<result column="ma_specifications" property="ma_specifications"/>
</resultMap>

<resultMap type="ObtainVO" id="ObtainVO">
	<result column="obtain_no" property="obtain_no"/>
	<result column="user_id" property="user_id"/>
	<result column="obtain_quantity" property="obtain_quantity"/>
	<result column="obtain_deliveryDate" property="obtain_deliveryDate"/>
	<result column="obtain_status" property="obtain_status"/>
	<result column="production_no" property="production_no"/>
	<result column="ma_id" property="ma_id"/>
	<collection property="materialVO" javaType="materialVO" resultMap="MaterialVO"/>	
</resultMap>
	

<select id="obtain_malist" resultMap="ObtainVO">
select 
ob.obtain_no,ob.user_id,ob.obtain_quantity,ob.obtain_deliveryDate,ob.obtain_status,ob.production_no,ob.ma_id,
ma.ma_name,ma.ma_price,ma.ma_unit,ma.ma_specifications
from obtain as ob
inner join material as ma
ON ob.ma_id = ma.ma_id
where ob.obtain_status='조달중'
</select>

<select id="radio_value" parameterType="ObtainVO" resultMap="ObtainVO">
select 
ob.obtain_no,ob.user_id,ob.obtain_quantity,ob.obtain_deliveryDate,ob.obtain_status,
ma.ma_name,ma.ma_price,ma.ma_unit,ma.ma_specifications
from obtain as ob
inner join material as ma
ON ob.ma_id = ma.ma_id
where ob.obtain_status='조달중' and ob.obtain_no=#{obtain_no}
</select>

<!--입고 후 발주담당자 이메일 보내기 -> 이메일 찾기-->
<select id="io_OK_email" parameterType="int" resultType="java.util.HashMap">

select user_id,user_email
from user
where user_id=(select user_id from obtain where obtain_no=#{obtain_no});
</select>


<!--io_status 검수확인-->
<update id="io_status_change" parameterType="IOVO" >
update 	io 
set io_status=#{io_status},invoice_issuance_status=#{invoice_issuance_status}
where io_id=#{io_id}

</update>




<!--material 상세리스트 수정-->
<!--입고출고 정보 상세조회-->




</mapper>